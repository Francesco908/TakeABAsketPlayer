local Player = game:GetService("Players").LocalPlayer
local PlayerGui = Player:WaitForChild("PlayerGui")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")

-- Configurazione
local API_KEY = "AIzaSyCs7MOursJk-vCG9ycl_vDBtbDUJUz_0KE"
local CANVAS_NAME = "DrawingCanvas" -- Nome della tela nel tuo gioco
local DRAW_COLOR = Color3.new(0, 0, 0) -- Colore del disegno (nero)

-- Crea il GUI principale
local aiHub = Instance.new("ScreenGui")
aiHub.Name = "AI_HUB"
aiHub.ResetOnSpawn = false

local mainFrame = Instance.new("Frame")
mainFrame.Name = "MainFrame"
mainFrame.Size = UDim2.new(0, 350, 0, 200)
mainFrame.Position = UDim2.new(0.5, -175, 0.5, -100)
mainFrame.AnchorPoint = Vector2.new(0.5, 0.5)
mainFrame.BackgroundColor3 = Color3.new(0.2, 0.2, 0.2)
mainFrame.BorderSizePixel = 0
mainFrame.ClipsDescendants = true

local titleBar = Instance.new("Frame")
titleBar.Name = "TitleBar"
titleBar.Size = UDim2.new(1, 0, 0, 30)
titleBar.BackgroundColor3 = Color3.new(0.1, 0.1, 0.1)
titleBar.BorderSizePixel = 0

local titleText = Instance.new("TextLabel")
titleText.Name = "Title"
titleText.Size = UDim2.new(0.7, 0, 1, 0)
titleText.BackgroundTransparency = 1
titleText.Text = "AI Drawing Hub"
titleText.TextColor3 = Color3.new(1, 1, 1)
titleText.Font = Enum.Font.SourceSansBold

local minimizeBtn = Instance.new("TextButton")
minimizeBtn.Name = "MinimizeBtn"
minimizeBtn.Size = UDim2.new(0, 30, 0, 30)
minimizeBtn.Position = UDim2.new(1, -60, 0, 0)
minimizeBtn.BackgroundTransparency = 1
minimizeBtn.Text = "_"
minimizeBtn.TextColor3 = Color3.new(1, 1, 1)

local closeBtn = Instance.new("TextButton")
closeBtn.Name = "CloseBtn"
closeBtn.Size = UDim2.new(0, 30, 0, 30)
closeBtn.Position = UDim2.new(1, -30, 0, 0)
closeBtn.BackgroundTransparency = 1
closeBtn.Text = "X"
closeBtn.TextColor3 = Color3.new(1, 1, 1)

local contentFrame = Instance.new("Frame")
contentFrame.Name = "Content"
contentFrame.Size = UDim2.new(1, 0, 1, -30)
contentFrame.Position = UDim2.new(0, 0, 0, 30)
contentFrame.BackgroundTransparency = 1

local promptLabel = Instance.new("TextLabel")
promptLabel.Name = "Prompt"
promptLabel.Size = UDim2.new(1, -20, 0, 40)
promptLabel.Position = UDim2.new(0, 10, 0, 10)
promptLabel.BackgroundTransparency = 1
promptLabel.Text = "Cosa vuoi disegnare oggi?"
promptLabel.TextColor3 = Color3.new(1, 1, 1)
promptLabel.TextSize = 20

local inputBox = Instance.new("TextBox")
inputBox.Name = "InputBox"
inputBox.Size = UDim2.new(1, -20, 0, 40)
inputBox.Position = UDim2.new(0, 10, 0, 60)
inputBox.BackgroundColor3 = Color3.new(0.3, 0.3, 0.3)
inputBox.PlaceholderText = "Inserisci un tema..."
inputBox.TextColor3 = Color3.new(1, 1, 1)
inputBox.ClearTextOnFocus = false

local drawBtn = Instance.new("TextButton")
drawBtn.Name = "DrawButton"
drawBtn.Size = UDim2.new(0.5, -25, 0, 40)
drawBtn.Position = UDim2.new(0, 10, 0, 110)
drawBtn.BackgroundColor3 = Color3.new(0, 0.5, 1)
drawBtn.Text = "Disegna!"
drawBtn.TextColor3 = Color3.new(1, 1, 1)

-- Assemblaggio GUI
titleBar.Parent = mainFrame
titleText.Parent = titleBar
minimizeBtn.Parent = titleBar
closeBtn.Parent = titleBar
contentFrame.Parent = mainFrame
promptLabel.Parent = contentFrame
inputBox.Parent = contentFrame
drawBtn.Parent = contentFrame
mainFrame.Parent = aiHub

-- Variabili di stato
local minimized = false
local originalSize = mainFrame.Size
local dragging = false
local dragStartPos, frameStartPos

-- Funzioni di movimento
titleBar.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = true
        dragStartPos = Vector2.new(input.Position.X, input.Position.Y)
        frameStartPos = mainFrame.Position
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
        local delta = Vector2.new(input.Position.X, input.Position.Y) - dragStartPos
        mainFrame.Position = UDim2.new(
            frameStartPos.X.Scale,
            frameStartPos.X.Offset + delta.X,
            frameStartPos.Y.Scale,
            frameStartPos.Y.Offset + delta.Y
        )
    end
end)

UserInputService.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = false
    end
end)

-- Funzioni finestra
minimizeBtn.MouseButton1Click:Connect(function()
    minimized = not minimized
    if minimized then
        contentFrame.Visible = false
        mainFrame.Size = UDim2.new(0, 150, 0, 30)
    else
        contentFrame.Visible = true
        mainFrame.Size = originalSize
    end
end)

closeBtn.MouseButton1Click:Connect(function()
    aiHub.Enabled = false
end)

-- Funzione di disegno automatico
local function drawOnCanvas(drawingData)
    local canvas = workspace:FindFirstChild(CANVAS_NAME)
    if not canvas then
        warn("Canvas non trovato! Assicurati di avere un oggetto chiamato '"..CANVAS_NAME.."' nel Workspace")
        return
    end
    
    local function drawPixel(position)
        local part = Instance.new("Part")
        part.Size = Vector3.new(0.2, 0.2, 0.01)
        part.Position = position
        part.Anchored = true
        part.CanCollide = false
        part.Color = DRAW_COLOR
        part.Parent = canvas
    end

    -- Simulazione disegno basato sul tema
    if drawingData == "sole" then
        -- Disegno un sole
        local center = canvas.Position + Vector3.new(0, 2, 0)
        for i = 0, 360, 30 do
            local angle = math.rad(i)
            local ray = Vector3.new(math.cos(angle), math.sin(angle), 0) * 3
            for j = 0, 1, 0.1 do
                drawPixel(center + ray * j)
            end
        end
        for i = 0, 360, 10 do
            local angle = math.rad(i)
            drawPixel(center + Vector3.new(math.cos(angle), math.sin(angle), 0) * 1.5)
        end
        
    elseif drawingData == "casa" then
        -- Disegno una casa
        local basePos = canvas.Position
        -- Base quadrata
        for x = -2, 2, 0.2 do
            for z = -2, 2, 0.2 do
                drawPixel(basePos + Vector3.new(x, 0.5, z))
            end
        end
        -- Tetto
        for i = -2, 2, 0.2 do
            for j = 0, 1.5, 0.1 do
                drawPixel(basePos + Vector3.new(i, 1.5 + j, j))
                drawPixel(basePos + Vector3.new(i, 1.5 + j, -j))
            end
        end
        
    else
        -- Disegno generico a forma di cuore
        local center = canvas.Position + Vector3.new(0, 2, 0)
        for t = 0, math.pi * 2, 0.05 do
            local x = 16 * math.sin(t)^3
            local y = 13 * math.cos(t) - 5 * math.cos(2*t) - 2 * math.cos(3*t) - math.cos(4*t)
            drawPixel(center + Vector3.new(x/5, -y/5, 0))
        end
    end
end

-- Funzione di riconoscimento tema (simulata)
local function recognizeTheme(inputText)
    inputText = string.lower(inputText)
    
    -- Mappatura temi semplici
    local themeMap = {
        ["sole"] = {"sole", "sun", "stellar"},
        ["casa"] = {"casa", "house", "home", "abitazione"},
        ["cuore"] = {"cuore", "heart", "amore"}
    }
    
    for theme, keywords in pairs(themeMap) do
        for _, kw in ipairs(keywords) do
            if string.find(inputText, kw) then
                return theme
            end
        end
    end
    
    return inputText -- Torna l'input originale se nessun match
end

-- Gestione richiesta disegno
drawBtn.MouseButton1Click:Connect(function()
    local theme = inputBox.Text
    if theme == "" then return end
    
    -- Analizza il tema
    local recognizedTheme = recognizeTheme(theme)
    
    -- Pulisci la tela esistente
    local canvas = workspace:FindFirstChild(CANVAS_NAME)
    if canvas then
        for _, child in ipairs(canvas:GetChildren()) do
            if child:IsA("BasePart") then
                child:Destroy()
            end
        end
    end
    
    -- Esegui il disegno
    drawOnCanvas(recognizedTheme)
    inputBox.Text = ""
end)

-- Attivazione iniziale
aiHub.Parent = PlayerGui
